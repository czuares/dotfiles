#!/bin/bash

# aws-token() { 
#     oathtool --totp -b "$(<~/.oath-aws)" | pbcopy
# }

function okta-token() { 
    oathtool --totp -b "$(<~/.oath-okta)" | pbcopy
}

function awsp() {
    if [ $# -lt 1 ]; then 
        echo "Usage: awsp <profile>"
        unset AWS_DEFAULT_PROFILE
        unset AWS_PROFILE
        unset AWS_REGION
        unset KOPS_STATE_STORE
        return 1
    fi

    export AWS_DEFAULT_PROFILE=$1;
    export AWS_PROFILE=$1;
    export AWS_REGION=$(aws configure get region --profile "$1");
    export KOPS_STATE_STORE="s3://syapse-terraform/$AWS_PROFILE/kops"
    okta-token
    saml2aws login -a "$1" --skip-prompt
    pbcopy < /dev/null
    echo "Switched to AWS Profile: $1";
};
